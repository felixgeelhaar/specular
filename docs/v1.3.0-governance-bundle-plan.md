# v1.3.0 Governance Bundle - Implementation Plan

**Status:** Planned for Q1-Q2 2025
**Target Release:** March-April 2025
**Dependencies:** v1.2.0 CLI Enhancement (✅ Complete)
**Follows:** v1.2.0 | **Precedes:** v1.4.0 (Pro Tier Licensing)

---

## 1. Vision & Strategic Goals

### The Problem We're Solving

Currently (v1.2.0), Specular provides excellent local governance:
- ✅ Specs are locked and versioned
- ✅ Policies enforce development guardrails
- ✅ Drift detection identifies misalignment
- ✅ Routing intelligence optimizes model selection

**But there's a critical gap:**
- ❌ No way to **package and distribute** governance artifacts
- ❌ No **cryptographic verification** of governance compliance
- ❌ No **team collaboration** on governance decisions
- ❌ No **reproducible builds** with provable provenance

### The Solution: Governance Bundles

**Governance Bundles** (`.sbundle.tgz`) are portable, signed, verifiable archives containing:
- Complete governance configuration (spec, policies, routing)
- Team approval signatures
- Cryptographic attestations (Sigstore/in-toto)
- Checksums for integrity verification
- Metadata for audit trails

**Value Proposition:**
- **For Developers**: Share governance configs like Docker images
- **For Teams**: Collaborative approval workflows
- **For Compliance Officers**: Cryptographic proof of governance
- **For CI/CD**: Reproducible, verifiable builds

---

## 2. Feature Breakdown

### 2.1 Bundle Specification (Core)

**Goal:** Define the structure, format, and semantics of Specular Bundles

#### Bundle Structure
```
bundle/
├── manifest.yaml           # Bundle metadata and integrity
├── spec.yaml              # Feature specification
├── spec.lock.json         # Locked dependencies snapshot
├── routing.yaml           # AI provider routing config
├── policies/              # Governance policies
│   └── default.yaml
├── approvals/             # Team approval signatures (v1.3.0)
│   ├── pm.json
│   └── lead.json
├── attestations/          # Cryptographic attestations (v1.3.0)
│   └── sigstore.json
└── checksums.txt          # SHA-256 checksums
```

#### Manifest Schema
```yaml
# manifest.yaml
schema: specular.bundle/v1
id: acme/healthcare-api
version: "1.3.0"
integrity:
  algo: sha256
  digest: "sha256:6f1a2e..."
content:
  files:
    - spec.yaml
    - spec.lock.json
    - routing.yaml
    - policies/default.yaml
approvals:
  required_roles: [pm, lead, security]
  signatures:
    - role: pm
      user: pm@acme.org
      signed_at: 2025-11-06T10:15:22Z
      digest: sha256:23ac9e...
attestation:
  format: sigstore
  provenance: attestations/sigstore.json
meta:
  created_by: specular-cli-v1.3.0
  toolchain: [go1.22, docker24.0]
  governance_level: L3
```

#### Implementation
- **Package:** `internal/bundle/`
- **Files:**
  - `bundle.go` - Core bundle types and operations
  - `manifest.go` - Manifest parsing and validation
  - `builder.go` - Bundle creation logic
  - `validator.go` - Bundle integrity verification
  - `extractor.go` - Bundle extraction and application
  - `registry.go` - Registry interaction (push/pull)
  - `bundle_test.go` - Comprehensive tests

### 2.2 Bundle Commands

**Goal:** Provide CLI commands for bundle lifecycle management

#### Command: `specular bundle build`

**Purpose:** Create a governance bundle from current project

**Usage:**
```bash
# Build basic bundle
specular bundle build --out healthcare-api.sbundle.tgz

# Build with approvals
specular bundle build \
  --out healthcare-api.sbundle.tgz \
  --require-approvals pm,lead,security

# Build with attestation
specular bundle build \
  --out healthcare-api.sbundle.tgz \
  --attest sigstore

# Include custom files
specular bundle build \
  --out healthcare-api.sbundle.tgz \
  --include docs/ \
  --include COMPLIANCE.md
```

**Implementation:**
1. Collect governance files (spec, lock, routing, policies)
2. Generate checksums (SHA-256)
3. Create manifest with metadata
4. Compress into tar.gz
5. Optional: Collect approvals
6. Optional: Generate attestations
7. Output bundle file

**Flags:**
- `--out <path>` - Output bundle path (required)
- `--include <path>` - Additional files to include
- `--require-approvals <roles>` - Required approval roles
- `--attest <format>` - Attestation format (sigstore, in-toto)
- `--strict` - Fail if any required approvals missing

#### Command: `specular bundle verify`

**Purpose:** Verify bundle integrity and signatures

**Usage:**
```bash
# Basic verification
specular bundle verify healthcare-api.sbundle.tgz

# Strict mode (requires all attestations)
specular bundle verify healthcare-api.sbundle.tgz --strict

# Verify against policy
specular bundle verify healthcare-api.sbundle.tgz \
  --policy .specular/policy.yaml
```

**Verification Steps:**
1. ✅ Extract and validate manifest
2. ✅ Verify file checksums against manifest
3. ✅ Validate approval signatures
4. ✅ Verify cryptographic attestations (if present)
5. ✅ Check policy compliance (if --policy provided)
6. ✅ Report verification results

**Output:**
```
✅ Verified bundle integrity
• SHA-256 digest match
• 3 approvals (pm, lead, security)
• Sigstore attestation OK
• Policy compliance: PASS

Bundle Details:
  ID:      acme/healthcare-api
  Version: 1.3.0
  Level:   L3 (Certified AI)
  Created: 2025-03-15T10:30:00Z
```

#### Command: `specular bundle apply`

**Purpose:** Extract and apply bundle to current project

**Usage:**
```bash
# Apply bundle to current directory
specular bundle apply healthcare-api.sbundle.tgz

# Preview changes (dry-run)
specular bundle apply healthcare-api.sbundle.tgz --dry-run

# Apply to specific directory
specular bundle apply healthcare-api.sbundle.tgz --dir ./my-project

# Force overwrite
specular bundle apply healthcare-api.sbundle.tgz --force
```

**Implementation:**
1. Verify bundle integrity
2. Extract to temporary directory
3. Show diff of changes (if not --yes)
4. Prompt for confirmation (unless --yes)
5. Copy files to target directory
6. Update .specular/bundle.info with metadata

**Flags:**
- `--dry-run` - Show what would be applied
- `--dir <path>` - Target directory (default: current)
- `--force` - Overwrite without prompting
- `--yes` - Auto-confirm all prompts

#### Command: `specular bundle diff`

**Purpose:** Compare two bundles or bundle vs current project

**Usage:**
```bash
# Compare two bundles
specular bundle diff bundle-v1.2.sbundle.tgz bundle-v1.3.sbundle.tgz

# Compare bundle with current project
specular bundle diff bundle.sbundle.tgz --current

# Machine-readable output
specular bundle diff bundle-old.sbundle.tgz bundle-new.sbundle.tgz --format json
```

**Output:**
```
Comparing: acme/healthcare-api v1.2.0 → v1.3.0

Changed Files:
  M spec.yaml               (+15, -3 lines)
  M routing.yaml            (+8, -2 lines)
  M policies/default.yaml   (+20, -5 lines)

Added Files:
  + policies/hipaa.yaml
  + attestations/sigstore.json

Removed Files:
  - policies/legacy.yaml

Approval Changes:
  + security (new required role)

Summary:
  3 files modified
  2 files added
  1 file removed
  1 new approval role
```

#### Command: `specular bundle push`

**Purpose:** Publish bundle to OCI registry (GHCR, Docker Hub, etc.)

**Usage:**
```bash
# Push to GHCR
specular bundle push ghcr.io/acme/healthcare-api:v1.3.0 \
  --bundle healthcare-api.sbundle.tgz

# Push with authentication
specular bundle push ghcr.io/acme/healthcare-api:v1.3.0 \
  --bundle healthcare-api.sbundle.tgz \
  --username acme-bot \
  --password $GITHUB_TOKEN

# Push and tag as latest
specular bundle push ghcr.io/acme/healthcare-api:v1.3.0 \
  --bundle healthcare-api.sbundle.tgz \
  --also-tag latest
```

**Implementation:**
1. Verify bundle integrity
2. Authenticate with registry
3. Convert bundle to OCI artifact format
4. Push layers to registry
5. Update manifest and tags
6. Confirm successful push

**Flags:**
- `--bundle <path>` - Bundle file to push
- `--username <user>` - Registry username
- `--password <pass>` - Registry password (or token)
- `--also-tag <tag>` - Additional tag(s) to apply
- `--platform <platform>` - Target platform (linux/amd64, etc.)

#### Command: `specular bundle pull`

**Purpose:** Download bundle from OCI registry

**Usage:**
```bash
# Pull latest
specular bundle pull ghcr.io/acme/healthcare-api:latest

# Pull specific version
specular bundle pull ghcr.io/acme/healthcare-api:v1.3.0

# Pull and verify
specular bundle pull ghcr.io/acme/healthcare-api:v1.3.0 --verify

# Pull to specific file
specular bundle pull ghcr.io/acme/healthcare-api:v1.3.0 \
  --out ./bundles/healthcare-api.sbundle.tgz
```

**Implementation:**
1. Authenticate with registry
2. Fetch manifest and layers
3. Download and assemble bundle
4. Verify integrity (if --verify)
5. Save to output path

### 2.3 Approval Workflows

**Goal:** Enable team approval and sign-off on governance artifacts

#### Approval Signature Format
```json
{
  "role": "pm",
  "user": "alice@acme.org",
  "signed_at": "2025-03-15T10:30:00Z",
  "digest": "sha256:23ac9e...",
  "signature": "MEUCIQD...",
  "public_key": "ssh-rsa AAAAB3..."
}
```

#### Command: `specular approve`

**Usage:**
```bash
# Approve current spec
specular approve --role pm

# Approve with comment
specular approve --role lead --comment "LGTM after security review"

# Approve specific file
specular approve --role security --file spec.yaml
```

**Implementation:**
1. Load current spec/bundle
2. Compute digest
3. Sign with user's private key (SSH or GPG)
4. Store approval in .specular/approvals/
5. Update manifest if in bundle

#### Command: `specular approval status`

**Usage:**
```bash
# Show approval status
specular approval status

# Output:
# Approval Status: 2/3 required roles
#
# ✅ pm (alice@acme.org) - 2025-03-15 10:30:00
# ✅ lead (bob@acme.org) - 2025-03-15 11:45:00
# ⏳ security - Pending
#
# Required for bundle creation: 1 more approval needed
```

### 2.4 Attestation System

**Goal:** Provide cryptographic proof of governance compliance

#### Sigstore Integration

**What is Sigstore?**
- Keyless signing infrastructure
- Transparency log for audit
- Widely adopted in cloud-native ecosystem

**Implementation:**
```go
// internal/bundle/attestation.go
package bundle

import (
    "github.com/sigstore/cosign/v2/pkg/cosign"
    "github.com/sigstore/cosign/v2/pkg/types"
)

type AttestationGenerator struct {
    bundlePath string
    options    *AttestationOptions
}

type AttestationOptions struct {
    Format      string // "sigstore" | "in-toto"
    RekorURL    string // Transparency log URL
    FulcioURL   string // Certificate authority URL
    IDToken     string // OIDC identity token
}

func (g *AttestationGenerator) Generate() (*Attestation, error) {
    // 1. Create in-toto predicate
    predicate := &intoto.Statement{
        Type: "https://in-toto.io/Statement/v1",
        Subject: []intoto.Subject{{
            Name: g.bundlePath,
            Digest: map[string]string{
                "sha256": computeSHA256(g.bundlePath),
            },
        }},
        PredicateType: "https://slsa.dev/provenance/v1",
        Predicate: map[string]interface{}{
            "builder": map[string]string{
                "id": "https://github.com/specular-ai/specular",
            },
            "buildType": "governed-release",
            "buildConfig": map[string]interface{}{
                "version":  "1.3.0",
                "policies": []string{"docker_only", "no_pii"},
            },
        },
    }

    // 2. Sign with Sigstore (keyless)
    signature, err := cosign.SignBlobCmd(
        context.Background(),
        g.options.IDToken,
        g.bundlePath,
        // ... options
    )
    if err != nil {
        return nil, err
    }

    // 3. Store in transparency log
    entry, err := rekor.Upload(signature)
    if err != nil {
        return nil, err
    }

    return &Attestation{
        Format:       "sigstore",
        Predicate:    predicate,
        Signature:    signature,
        RekorEntry:   entry,
        Certificate:  getCertFromFulcio(),
    }, nil
}
```

#### Attestation Verification
```bash
# Verify bundle with Sigstore
specular bundle verify healthcare-api.sbundle.tgz \
  --require-attestation sigstore

# Verify against transparency log
specular bundle verify healthcare-api.sbundle.tgz \
  --verify-rekor
```

### 2.5 Registry Integration

**Goal:** Store and distribute bundles via OCI registries

#### Supported Registries
- GitHub Container Registry (GHCR)
- Docker Hub
- Google Artifact Registry
- AWS ECR
- Azure Container Registry
- Harbor
- Self-hosted registries

#### OCI Artifact Format

Bundles are stored as OCI artifacts with custom media types:

```json
{
  "schemaVersion": 2,
  "mediaType": "application/vnd.oci.image.manifest.v1+json",
  "config": {
    "mediaType": "application/vnd.specular.bundle.config.v1+json",
    "size": 1234,
    "digest": "sha256:abc123..."
  },
  "layers": [
    {
      "mediaType": "application/vnd.specular.bundle.layer.v1.tar+gzip",
      "size": 5678,
      "digest": "sha256:def456..."
    }
  ],
  "annotations": {
    "org.opencontainers.image.title": "acme/healthcare-api",
    "org.opencontainers.image.version": "1.3.0",
    "dev.specular.governance.level": "L3"
  }
}
```

#### Implementation
```go
// internal/bundle/registry.go
package bundle

import (
    "github.com/google/go-containerregistry/pkg/v1/remote"
    "github.com/google/go-containerregistry/pkg/v1/types"
)

type RegistryClient struct {
    baseURL string
    auth    authn.Authenticator
}

func (c *RegistryClient) Push(ref string, bundle *Bundle) error {
    // 1. Create OCI artifact from bundle
    artifact := createOCIArtifact(bundle)

    // 2. Push to registry
    err := remote.Write(
        ref,
        artifact,
        remote.WithAuth(c.auth),
    )

    return err
}

func (c *RegistryClient) Pull(ref string) (*Bundle, error) {
    // 1. Pull from registry
    artifact, err := remote.Image(
        ref,
        remote.WithAuth(c.auth),
    )
    if err != nil {
        return nil, err
    }

    // 2. Extract bundle from artifact
    bundle, err := extractBundleFromOCI(artifact)

    return bundle, err
}
```

---

## 3. Architecture Changes

### 3.1 New Packages

```
internal/
├── bundle/
│   ├── bundle.go           # Core bundle types
│   ├── manifest.go         # Manifest handling
│   ├── builder.go          # Bundle creation
│   ├── validator.go        # Integrity verification
│   ├── extractor.go        # Bundle extraction
│   ├── registry.go         # OCI registry operations
│   ├── attestation.go      # Sigstore/in-toto integration
│   ├── approval.go         # Approval workflow
│   └── bundle_test.go
├── cmd/
│   ├── bundle.go           # Bundle commands
│   └── approve.go          # Approval commands
└── config/
    └── bundle_config.go    # Bundle configuration
```

### 3.2 Updated Configuration

```yaml
# .specular/config.yaml (new fields for v1.3.0)
bundle:
  registry: ghcr.io/acme
  default_approvers:
    - role: pm
      users: [alice@acme.org]
    - role: lead
      users: [bob@acme.org]
    - role: security
      users: [carol@acme.org]
  attestation:
    enabled: true
    format: sigstore
    rekor_url: https://rekor.sigstore.dev
  auto_include:
    - docs/
    - COMPLIANCE.md
```

### 3.3 Data Models

```go
// internal/bundle/bundle.go
package bundle

type Bundle struct {
    Manifest    *Manifest
    Spec        *spec.ProductSpec
    SpecLock    *spec.SpecLock
    Routing     *router.Config
    Policies    []*policy.Policy
    Approvals   []*Approval
    Attestation *Attestation
    Checksums   map[string]string
}

type Manifest struct {
    Schema      string                 `yaml:"schema"`
    ID          string                 `yaml:"id"`
    Version     string                 `yaml:"version"`
    Integrity   IntegrityInfo          `yaml:"integrity"`
    Content     ContentInfo            `yaml:"content"`
    Approvals   ApprovalRequirements   `yaml:"approvals"`
    Attestation *AttestationInfo       `yaml:"attestation,omitempty"`
    Meta        map[string]string      `yaml:"meta"`
}

type Approval struct {
    Role       string    `json:"role"`
    User       string    `json:"user"`
    SignedAt   time.Time `json:"signed_at"`
    Digest     string    `json:"digest"`
    Signature  string    `json:"signature"`
    PublicKey  string    `json:"public_key,omitempty"`
    Comment    string    `json:"comment,omitempty"`
}

type Attestation struct {
    Format      string                 `json:"format"`
    Predicate   *intoto.Statement      `json:"predicate"`
    Signature   string                 `json:"signature"`
    Certificate string                 `json:"certificate,omitempty"`
    RekorEntry  *RekorEntry            `json:"rekor_entry,omitempty"`
}
```

---

## 4. Testing Strategy

### 4.1 Unit Tests

**Coverage Target:** 90%+

```go
// internal/bundle/builder_test.go
func TestBundleBuilder(t *testing.T) {
    tests := []struct {
        name        string
        options     BuildOptions
        expectError bool
    }{
        {
            name: "basic bundle creation",
            options: BuildOptions{
                SpecPath:   "testdata/spec.yaml",
                OutputPath: "test.sbundle.tgz",
            },
            expectError: false,
        },
        {
            name: "bundle with approvals",
            options: BuildOptions{
                SpecPath:         "testdata/spec.yaml",
                OutputPath:       "test.sbundle.tgz",
                RequireApprovals: []string{"pm", "lead"},
            },
            expectError: false,
        },
        // ... more tests
    }
    // Test execution...
}
```

### 4.2 Integration Tests

**Test Scenarios:**
1. End-to-end bundle lifecycle (build → verify → apply)
2. Registry push/pull workflow
3. Approval workflow with multiple approvers
4. Attestation generation and verification
5. Bundle diff and comparison

```bash
#!/bin/bash
# test-e2e-bundle.sh

# Create test project
mkdir -p /tmp/bundle-test
cd /tmp/bundle-test
specular init --template web-app --yes

# Build bundle
specular bundle build --out test.sbundle.tgz

# Verify bundle
specular bundle verify test.sbundle.tgz

# Extract to new location
mkdir -p /tmp/bundle-extract
cd /tmp/bundle-extract
specular bundle apply /tmp/bundle-test/test.sbundle.tgz

# Verify extracted files
diff -r /tmp/bundle-test/.specular /tmp/bundle-extract/.specular

# Cleanup
rm -rf /tmp/bundle-test /tmp/bundle-extract
```

### 4.3 Security Tests

**Test Scenarios:**
1. Tampered bundle detection
2. Invalid signature rejection
3. Expired certificate handling
4. Checksum mismatch detection
5. Malicious file inclusion prevention

---

## 5. Documentation

### 5.1 User Guide Updates

**New Sections:**
- Bundle Concepts and Workflow
- Creating Your First Bundle
- Team Approval Process
- Publishing to Registries
- Verifying Bundle Integrity
- Troubleshooting Bundles

### 5.2 CLI Reference

**Commands to Document:**
- `specular bundle build`
- `specular bundle verify`
- `specular bundle apply`
- `specular bundle diff`
- `specular bundle push`
- `specular bundle pull`
- `specular approve`
- `specular approval status`

### 5.3 Examples

**Example 1: Team Workflow**
```bash
# PM creates spec and gets approval
specular init --template api-service
vim .specular/spec.yaml
specular approve --role pm

# Lead reviews and approves
specular approval status
specular approve --role lead

# Security reviews policies and approves
specular approve --role security --file .specular/policy.yaml

# Build and publish bundle
specular bundle build \
  --out healthcare-api-v1.0.sbundle.tgz \
  --require-approvals pm,lead,security \
  --attest sigstore

specular bundle push ghcr.io/acme/healthcare-api:v1.0 \
  --bundle healthcare-api-v1.0.sbundle.tgz
```

**Example 2: CI/CD Integration**
```yaml
# .github/workflows/bundle-release.yml
name: Bundle Release

on:
  push:
    tags: ['v*.*.*']

jobs:
  release:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
      id-token: write

    steps:
      - uses: actions/checkout@v4

      - name: Build bundle
        run: |
          specular bundle build \
            --out specular-governance.sbundle.tgz \
            --attest sigstore \
            --strict

      - name: Verify bundle
        run: |
          specular bundle verify \
            specular-governance.sbundle.tgz \
            --strict

      - name: Push to GHCR
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo $GITHUB_TOKEN | docker login ghcr.io -u ${{ github.actor }} --password-stdin
          specular bundle push \
            ghcr.io/${{ github.repository }}:${{ github.ref_name }} \
            --bundle specular-governance.sbundle.tgz \
            --also-tag latest
```

---

## 6. Dependencies

### 6.1 New Go Dependencies

```go
// Required for OCI registry support
github.com/google/go-containerregistry v0.19.0

// Required for Sigstore attestations
github.com/sigstore/cosign/v2 v2.2.3
github.com/sigstore/rekor v1.3.5

// Required for in-toto attestations
github.com/in-toto/in-toto-golang v0.9.0

// Required for tar/gzip operations
archive/tar
compress/gzip
```

### 6.2 External Services

**Optional (for attestation):**
- Sigstore Public Good Infrastructure
  - Rekor (transparency log): https://rekor.sigstore.dev
  - Fulcio (certificate authority): https://fulcio.sigstore.dev

**Optional (for registry):**
- OCI-compatible registry (GHCR, Docker Hub, etc.)

---

## 7. Migration Path

### 7.1 From v1.2.0 to v1.3.0

**Backward Compatibility:**
- ✅ All v1.2.0 commands continue to work
- ✅ Existing specs, locks, and policies are compatible
- ✅ No breaking changes to existing workflows

**New Capabilities:**
- Bundle creation from existing projects
- Optional approval workflows
- Optional attestation generation

**Migration Steps:**
1. Update to v1.3.0
2. (Optional) Initialize approval workflow
3. (Optional) Configure attestation
4. Create first bundle: `specular bundle build`
5. (Optional) Push to registry

### 7.2 Configuration Migration

No configuration migration required - bundles are an additive feature.

**Optional Enhancement:**
```bash
# Add bundle config to existing project
cat >> .specular/config.yaml <<EOF
bundle:
  registry: ghcr.io/your-org
  default_approvers:
    - role: lead
      users: [you@example.com]
EOF
```

---

## 8. Success Metrics

### 8.1 Technical Metrics

- Bundle build time < 5 seconds (for typical project)
- Bundle verification time < 2 seconds
- Registry push/pull time < 10 seconds (1MB bundle)
- Test coverage > 90%
- Zero critical security vulnerabilities

### 8.2 User Metrics

- % of users creating bundles (target: 30% in first month)
- % of bundles with approvals (target: 50%)
- % of bundles with attestations (target: 20%)
- Average time from bundle creation to deployment (target: < 1 hour)

### 8.3 Quality Metrics

- Bundle verification success rate (target: 99.9%)
- Registry push/pull success rate (target: 99.5%)
- User-reported bundle issues (target: < 5 per month)

---

## 9. Timeline & Milestones

### Phase 1: Foundation (Weeks 1-2)

**Week 1:**
- [ ] Design bundle data structures
- [ ] Implement bundle builder
- [ ] Implement bundle validator
- [ ] Write unit tests (coverage > 80%)

**Week 2:**
- [ ] Implement bundle extractor
- [ ] Add checksum generation/verification
- [ ] Implement `bundle build` command
- [ ] Implement `bundle verify` command
- [ ] Implement `bundle apply` command

**Deliverable:** Basic bundle lifecycle working locally

### Phase 2: Registry Integration (Weeks 3-4)

**Week 3:**
- [ ] Integrate go-containerregistry library
- [ ] Implement OCI artifact conversion
- [ ] Implement `bundle push` command
- [ ] Add registry authentication

**Week 4:**
- [ ] Implement `bundle pull` command
- [ ] Add registry error handling
- [ ] Test with GHCR, Docker Hub
- [ ] Write integration tests

**Deliverable:** Full registry support for bundle distribution

### Phase 3: Approvals & Attestations (Weeks 5-6)

**Week 5:**
- [ ] Design approval data structures
- [ ] Implement approval signing (SSH/GPG)
- [ ] Implement `approve` command
- [ ] Implement `approval status` command
- [ ] Add approval verification to bundle validator

**Week 6:**
- [ ] Integrate Sigstore libraries
- [ ] Implement attestation generation
- [ ] Implement attestation verification
- [ ] Add `--attest` flag to `bundle build`
- [ ] Add `--verify-attestation` flag to `bundle verify`

**Deliverable:** Complete governance workflow with approvals and attestations

### Phase 4: Polish & Documentation (Weeks 7-8)

**Week 7:**
- [ ] Implement `bundle diff` command
- [ ] Add comprehensive error messages
- [ ] Performance optimization
- [ ] Security audit
- [ ] Final integration tests

**Week 8:**
- [ ] Write user documentation
- [ ] Create example workflows
- [ ] Record demo videos
- [ ] Update PRD and technical design
- [ ] Prepare release notes

**Deliverable:** v1.3.0 ready for release

---

## 10. Risk Assessment & Mitigation

### 10.1 Technical Risks

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| OCI registry compatibility issues | High | Medium | Test with multiple registries early |
| Sigstore infrastructure outages | Medium | Low | Make attestation optional, cache results |
| Bundle size too large | Medium | Low | Implement compression, exclude unnecessary files |
| Performance degradation | Low | Low | Benchmark early, optimize hot paths |

### 10.2 User Experience Risks

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Complex approval workflow | High | Medium | Provide clear examples, make approvals optional |
| Confusing bundle concepts | Medium | Medium | Comprehensive documentation, tutorials |
| Registry authentication issues | Medium | High | Support multiple auth methods, clear error messages |

### 10.3 Security Risks

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Bundle tampering | Critical | Low | Mandatory checksum verification |
| Signature spoofing | Critical | Low | Use established crypto libraries (Sigstore) |
| Malicious bundle injection | High | Low | Verify before apply, show diff preview |
| Registry credential leakage | High | Low | Never log credentials, use keychain integration |

---

## 11. Open Questions

1. **Approval Key Management:** Should we support hardware security keys (YubiKey, etc.)?
   - **Recommendation:** Start with SSH/GPG keys, add hardware key support in v1.3.1

2. **Bundle Versioning:** How to handle breaking changes in bundle format?
   - **Recommendation:** Include schema version in manifest, implement migration tool

3. **Registry Selection:** Should we provide hosted registry or require self-hosting?
   - **Recommendation:** Support public registries (GHCR) first, add hosted option in Enterprise

4. **Attestation Fallback:** What happens if Sigstore is unavailable?
   - **Recommendation:** Cache attestations locally, allow offline verification for 7 days

5. **Large Bundles:** How to handle projects with large policy directories?
   - **Recommendation:** Implement `.specularignore` file, compress efficiently

---

## 12. Post-Release Plan

### 12.1 v1.3.1 (Patch Release)
- Bug fixes from user feedback
- Performance optimizations
- Additional registry support

### 12.2 v1.3.2 (Minor Enhancements)
- Bundle templates
- Automated approval notifications
- Enhanced diff visualization

### 12.3 Transition to v1.4.0 (Pro Tier)
- Bundle operations remain free
- Pro tier adds:
  - Private registry hosting
  - Advanced approval workflows
  - Team collaboration features
  - Bundle analytics dashboard

---

## 13. References

- Governance Bundle Roadmap: `docs/governance-bundle-roadmap.md`
- Bundle Specification (v1): `docs/specular_bundle_spec_v1.md`
- Release Strategy: `docs/specular_release_strategy_v1.md`
- OCI Distribution Spec: https://github.com/opencontainers/distribution-spec
- Sigstore Documentation: https://docs.sigstore.dev/
- in-toto Specification: https://github.com/in-toto/docs

---

## 14. Summary

**v1.3.0 Governance Bundle** transforms Specular from a local governance tool into a collaborative, verifiable, enterprise-ready platform. By introducing portable bundles with cryptographic attestations and team approval workflows, we enable:

1. **Reproducible Governance** - Package and share governance configurations
2. **Team Collaboration** - Multi-stakeholder approval workflows
3. **Cryptographic Trust** - Sigstore attestations for compliance proof
4. **Registry Distribution** - Store and distribute bundles like Docker images
5. **Audit Readiness** - Complete provenance tracking for governance artifacts

**Estimated Effort:** 8 weeks (2 months)
**Team Size:** 2-3 engineers
**Dependencies:** v1.2.0 CLI Enhancement (complete)
**Target Release:** Q1-Q2 2025
